<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pinoy Vibes Radio</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 20px;
    }
    #progress {
      width: 80%;
      height: 20px;
      background: #e0e0e0;
      border-radius: 10px;
      overflow: hidden;
      margin: 20px auto;
      position: relative;
    }
    #progress-bar {
      height: 100%;
      background: #007bff;
      width: 0%;
      transition: width 0.5s;
    }
    .info {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>ðŸŽµ Pinoy Vibes Radio ðŸŽµ</h1>
  <p id="song-title">Now Playing: <strong>Loading...</strong></p>
  <audio id="audio" controls autoplay></audio>
  <div id="progress">
    <div id="progress-bar"></div>
  </div>
  <div class="info">
    <span id="time">0:00 / 0:00</span> | 
    <span id="listeners">Listeners: 0</span>
  </div>

  <script>
    // WebSocket connection
    const ws = new WebSocket("ws://https://websocket-server-ptp5.onrender.com");

    // DOM elements
    const songTitle = document.getElementById("song-title");
    const audio = document.getElementById("audio");
    const progressBar = document.getElementById("progress-bar");
    const timeDisplay = document.getElementById("time");
    const listenersDisplay = document.getElementById("listeners");

    // State variables
    let duration = 0;

    ws.onopen = () => {
      console.log("Connected to WebSocket server");
    };

    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);

      // Update song info
      songTitle.innerHTML = `Now Playing: <strong>${data.songName}</strong>`;
      if (audio.src !== data.artworkUrl) {
        audio.src = data.artworkUrl; // Assuming this is the audio file URL
      }

      // Update progress and time
      duration = data.duration;
      const currentTime = data.currentTime;
      progressBar.style.width = `${(currentTime / duration) * 100}%`;
      timeDisplay.textContent = `${formatTime(currentTime)} / ${formatTime(duration)}`;

      // Update listeners
      listenersDisplay.textContent = `Listeners: ${data.listeners}`;
    };

    ws.onclose = () => {
      console.log("Disconnected from WebSocket server");
    };

    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${mins}:${secs < 10 ? "0" : ""}${secs}`;
    }
  </script>
</body>
</html>
